{
  "spec_version": 1,
  "app": {
    "title": "UESRPG Session Manager",
    "window": {
      "size": [1100, 720],
      "min_size": [980, 640],
      "resizable": true
    }
  },
  "theme": {
    "colors": {
      "bg": "#FFD5AF",
      "fg": "#9D6E6B",
      "panel_bg": "#FFD5AF",
      "border": "#9D6E6B",
      "accent": "#9D6E6B"
    },
    "typography": {
      "base": { "family": "TkDefaultFont", "size": 10, "weight": "normal", "slant": "roman" },
      "heading": { "family": "TkDefaultFont", "size": 11, "weight": "bold", "slant": "roman" },
      "skill": { "family": "TkDefaultFont", "size": 10, "weight": "normal", "slant": "italic" }
    },
    "spacing": {
      "padx": 8,
      "pady": 6,
      "section_gap_y": 10,
      "field_gap_x": 8,
      "field_gap_y": 4
    }
  },
  "data": {
    "character_root": "$",
    "portrait_dir": "uesrpg_sm/assets/portraits",
    "default_character": {
      "system": "UESRPG 3e",
      "name": "",
      "size": "",
      "xp": { "current": 0, "total": 0 },
      "race": "",
      "elite_adv": "",
      "favored_characteristics": [],
      "birthsign": { "category": "", "sign": "", "star_cursed": false, "effects": [] },
      "luck_numbers": { "lucky": [], "unlucky": [] },
      "characteristics": [
        { "abbr": "Str", "name": "Strength", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "End", "name": "Endurance", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "Ag", "name": "Agility", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "Int", "name": "Intelligence", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "Wp", "name": "Willpower", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "Prc", "name": "Perception", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "Prs", "name": "Personality", "score": 0, "bonus": 0, "favored": false },
        { "abbr": "Lck", "name": "Luck", "score": 0, "bonus": 0, "favored": false }
      ],
      "base_bonuses": { "SB": 0, "EB": 0, "AB": 0, "IB": 0, "WB": 0, "PcB": 0, "PsB": 0, "LB": 0 },
      "derived_stats": {
        "HP": { "current": 0, "max": 0 },
        "MP": { "current": 0, "max": 0 },
        "WT": { "current": 0, "max": 0 },
        "SP": { "current": 0, "max": 0 },
        "Speed_m": 0,
        "LP": { "current": 0, "max": 0 },
        "IR": 0,
        "AP": { "current": 0, "max": 0 },
        "Linguistics": 0,
        "ENC": { "current": 0, "max": 0 },
        "CR": 0
      },
      "languages": [],
      "bonds": [],
      "armor": {
        "slots": {
          "head_0": { "label": "Head (0)", "AR": 0, "ENC": 0, "Type": "" },
          "body_1_5": { "label": "Body (1-5)", "AR": 0, "ENC": 0, "Type": "" },
          "right_leg_6": { "label": "Right Leg (6)", "AR": 0, "ENC": 0, "Type": "" },
          "left_leg_7": { "label": "Left Leg (7)", "AR": 0, "ENC": 0, "Type": "" },
          "right_arm_8": { "label": "Right Arm (8)", "AR": 0, "ENC": 0, "Type": "" },
          "left_arm_9": { "label": "Left Arm (9)", "AR": 0, "ENC": 0, "Type": "" }
        },
        "shield": { "BR": 0, "Type": "", "ENC": 0 },
        "notes": ""
      },
      "wounds": "",
      "conditions": "",
      "skills": [],
      "professions_custom_skills": "",
      "combat_style": { "name": "", "governing": ["Strength", "Agility"] },
      "specializations": "",
      "melee_weapons": [],
      "ranged_weapons": [],
      "talents_traits_powers": "",
      "items_equipment": [],
      "total_enc": 0,
      "drakes": 0,
      "rituals": "",
      "magic_skills": [],
      "spellcasting": "",
      "spells": [],
      "portrait": { "file": "" }
    }
  },
  "menus": [
    {
      "label": "File",
      "items": [
        { "label": "New", "command": "file_new" },
        { "label": "Open…", "command": "file_open" },
        { "label": "Save", "command": "file_save" },
        { "label": "Save As…", "command": "file_save_as" },
        { "type": "separator" },
        { "label": "Exit", "command": "app_exit" }
      ]
    },
    {
      "label": "Import",
      "items": [
        { "label": "Import Character Data…", "command": "import_character_data" },
        { "label": "Export Character Data…", "command": "export_character_data" }
      ]
    }
  ],
  "_comment_windows": "Character window now uses 'sheet_view' as primary view (dashboard with portrait header + core stats + skills). 'details_panel' contains the notebook tabs for secondary data (gear/magic/etc). The old 'left_panel' sidebar is removed - portrait is now in the sheet header.",
  "windows": [
    {
      "id": "character_window",
      "type": "main",
      "title": "Character",
      "sheet_view": {
        "type": "sheet",
        "header": {
          "type": "layout_row",
          "widgets": [
            {
              "type": "portrait_box",
              "id": "portrait_display",
              "bind": "$.portrait.file",
              "size": [320, 200],
              "placeholder": "No portrait selected",
              "button_text": "Select Portrait…",
              "command": "select_portrait_from_dir"
            },
            {
              "type": "layout_col",
              "widgets": [
                {
                  "type": "group",
                  "title": "Identity",
                  "layout": { "type": "grid", "columns": 4 },
                  "widgets": [
                    { "type": "field", "label": "Name", "bind": "$.name", "widget": "entry", "colspan": 2 },
                    { "type": "field", "label": "Race", "bind": "$.race", "widget": "entry", "colspan": 1 },
                    { "type": "field", "label": "Size", "bind": "$.size", "widget": "entry", "colspan": 1 },
                    { "type": "field", "label": "Birthsign (category)", "bind": "$.birthsign.category", "widget": "entry", "colspan": 2 },
                    { "type": "field", "label": "Birthsign (sign)", "bind": "$.birthsign.sign", "widget": "entry", "colspan": 1 },
                    { "type": "field", "label": "Star-Cursed", "bind": "$.birthsign.star_cursed", "widget": "check", "colspan": 1 },
                    { "type": "field", "label": "Elite Adv.", "bind": "$.elite_adv", "widget": "entry", "colspan": 2 },
                    { "type": "field", "label": "XP (cur)", "bind": "$.xp.current", "widget": "spin_int", "min": 0, "max": 999999, "colspan": 1 },
                    { "type": "field", "label": "XP (tot)", "bind": "$.xp.total", "widget": "spin_int", "min": 0, "max": 999999, "colspan": 1 },
                    { "type": "field", "label": "Favored", "bind": "$.favored_characteristics", "widget": "tags", "hint": "e.g. Strength, Agility", "colspan": 2 },
                    { "type": "field", "label": "Lucky #s", "bind": "$.luck_numbers.lucky", "widget": "int_list_csv", "hint": "comma-separated", "colspan": 1 },
                    { "type": "field", "label": "Unlucky #s", "bind": "$.luck_numbers.unlucky", "widget": "int_list_csv", "hint": "comma-separated", "colspan": 1 }
                  ]
                }
              ]
            }
          ]
        },
        "core": {
          "type": "sheet_grid",
          "columns": 3,
          "widgets": [
            {
              "type": "group",
              "title": "Attributes",
              "layout": { "type": "grid", "columns": 4 },
              "widgets": [
                {
                  "type": "table_inline",
                  "id": "characteristics_inline",
                  "bind": "$.characteristics",
                  "columns": [
                    { "key": "abbr", "label": "Abbr", "width": 6, "readonly": true },
                    { "key": "score", "label": "Score", "width": 6 },
                    { "key": "bonus", "label": "Bonus", "width": 6 },
                    { "key": "favored", "label": "Fav", "width": 4, "widget": "check" }
                  ],
                  "row_order": ["Str", "End", "Ag", "Int", "Wp", "Prc", "Prs", "Lck"],
                  "style": "base",
                  "colspan": 4
                },
                {
                  "type": "stat_block",
                  "label": "SB",
                  "bind": "$.base_bonuses.SB"
                },
                {
                  "type": "stat_block",
                  "label": "EB",
                  "bind": "$.base_bonuses.EB"
                },
                {
                  "type": "stat_block",
                  "label": "AB",
                  "bind": "$.base_bonuses.AB"
                },
                {
                  "type": "stat_block",
                  "label": "IB",
                  "bind": "$.base_bonuses.IB"
                },
                {
                  "type": "stat_block",
                  "label": "WB",
                  "bind": "$.base_bonuses.WB"
                },
                {
                  "type": "stat_block",
                  "label": "PcB",
                  "bind": "$.base_bonuses.PcB"
                },
                {
                  "type": "stat_block",
                  "label": "PsB",
                  "bind": "$.base_bonuses.PsB"
                },
                {
                  "type": "stat_block",
                  "label": "LB",
                  "bind": "$.base_bonuses.LB"
                }
              ]
            },
            {
              "type": "group",
              "title": "Derived Stats",
              "layout": { "type": "grid", "columns": 2 },
              "widgets": [
                { "type": "stat_block", "label": "HP (cur)", "bind": "$.derived_stats.HP.current" },
                { "type": "stat_block", "label": "HP (max)", "bind": "$.derived_stats.HP.max" },
                { "type": "stat_block", "label": "MP (cur)", "bind": "$.derived_stats.MP.current" },
                { "type": "stat_block", "label": "MP (max)", "bind": "$.derived_stats.MP.max" },
                { "type": "stat_block", "label": "WT (cur)", "bind": "$.derived_stats.WT.current" },
                { "type": "stat_block", "label": "WT (max)", "bind": "$.derived_stats.WT.max" },
                { "type": "stat_block", "label": "SP (cur)", "bind": "$.derived_stats.SP.current" },
                { "type": "stat_block", "label": "SP (max)", "bind": "$.derived_stats.SP.max" },
                { "type": "stat_block", "label": "Speed", "bind": "$.derived_stats.Speed_m" },
                { "type": "stat_block", "label": "LP (cur)", "bind": "$.derived_stats.LP.current" },
                { "type": "stat_block", "label": "LP (max)", "bind": "$.derived_stats.LP.max" },
                { "type": "stat_block", "label": "IR", "bind": "$.derived_stats.IR" },
                { "type": "stat_block", "label": "AP (cur)", "bind": "$.derived_stats.AP.current" },
                { "type": "stat_block", "label": "AP (max)", "bind": "$.derived_stats.AP.max" },
                { "type": "stat_block", "label": "Ling.", "bind": "$.derived_stats.Linguistics" },
                { "type": "stat_block", "label": "ENC", "bind": "$.derived_stats.ENC.current" },
                { "type": "stat_block", "label": "ENC (max)", "bind": "$.derived_stats.ENC.max" },
                { "type": "stat_block", "label": "CR", "bind": "$.derived_stats.CR" }
              ]
            },
            {
              "type": "group",
              "title": "Combat Quick Block",
              "layout": { "type": "grid", "columns": 1 },
              "widgets": [
                {
                  "type": "group",
                  "title": "Armor",
                  "layout": { "type": "grid", "columns": 3 },
                  "widgets": [
                    {
                      "type": "table_inline",
                      "id": "armor_slots_quick",
                      "bind": "$.armor.slots",
                      "mode": "keyed_object",
                      "rows": [
                        { "key": "head_0", "label": "Head" },
                        { "key": "body_1_5", "label": "Body" },
                        { "key": "right_leg_6", "label": "R.Leg" }
                      ],
                      "columns": [
                        { "key": "AR", "label": "AR", "width": 4 },
                        { "key": "ENC", "label": "ENC", "width": 4 }
                      ],
                      "colspan": 3
                    }
                  ]
                },
                { "type": "field", "label": "Combat Style", "bind": "$.combat_style.name", "widget": "entry" }
              ]
            }
          ]
        },
        "content": {
          "type": "layout_col",
          "widgets": [
            {
              "type": "group",
              "title": "Skills",
              "layout": { "type": "grid", "columns": 1 },
              "widgets": [
                {
                  "type": "table",
                  "id": "skills_table_sheet",
                  "bind": "$.skills",
                  "style": "skill",
                  "columns": [
                    { "key": "name", "label": "Skill", "width": 34 },
                    { "key": "rank", "label": "Rank", "width": 12 },
                    { "key": "bonus", "label": "Bonus", "width": 8 },
                    { "key": "tn", "label": "TN", "width": 8 }
                  ],
                  "row_editor": {
                    "fields": [
                      { "label": "Skill", "key": "name", "widget": "entry" },
                      { "label": "Rank", "key": "rank", "widget": "entry" },
                      { "label": "Bonus", "key": "bonus", "widget": "spin_int", "min": -99, "max": 999 },
                      { "label": "TN", "key": "tn", "widget": "spin_int", "min": 0, "max": 999 },
                      { "label": "Governing", "key": "governing", "widget": "tags", "hint": "e.g. Agility, Perception" }
                    ],
                    "buttons": ["add", "update", "delete"]
                  }
                }
              ]
            }
          ]
        }
      },
      "details_panel": {
        "type": "notebook",
        "tabs": [
          {
            "id": "tab_combat",
            "title": "Combat",
            "sections": [
              {
                "id": "armor_block",
                "title": "Armor",
                "layout": { "type": "grid", "columns": 3 },
                "widgets": [
                  {
                    "type": "table_inline",
                    "id": "armor_slots",
                    "bind": "$.armor.slots",
                    "mode": "keyed_object",
                    "rows": [
                      { "key": "head_0", "label": "Head (0)" },
                      { "key": "body_1_5", "label": "Body (1-5)" },
                      { "key": "right_leg_6", "label": "Right Leg (6)" },
                      { "key": "left_leg_7", "label": "Left Leg (7)" },
                      { "key": "right_arm_8", "label": "Right Arm (8)" },
                      { "key": "left_arm_9", "label": "Left Arm (9)" }
                    ],
                    "columns": [
                      { "key": "AR", "label": "AR", "width": 6 },
                      { "key": "ENC", "label": "ENC", "width": 6 },
                      { "key": "Type", "label": "Type", "width": 16 }
                    ]
                  },
                  {
                    "type": "group",
                    "id": "shield",
                    "title": "Shield (BR/Type/ENC)",
                    "layout": { "type": "grid", "columns": 3 },
                    "widgets": [
                      { "type": "field", "label": "BR", "bind": "$.armor.shield.BR", "widget": "spin_int", "min": 0, "max": 99 },
                      { "type": "field", "label": "Type", "bind": "$.armor.shield.Type", "widget": "entry" },
                      { "type": "field", "label": "ENC", "bind": "$.armor.shield.ENC", "widget": "spin_int", "min": 0, "max": 99 }
                    ]
                  },
                  { "type": "field", "label": "Armor Notes", "bind": "$.armor.notes", "widget": "textarea", "height": 4, "colspan": 3 }
                ]
              },
              {
                "id": "weapons_block",
                "title": "Weapons",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  {
                    "type": "table",
                    "id": "melee_weapons",
                    "title": "Melee Weapons",
                    "bind": "$.melee_weapons",
                    "columns": [
                      { "key": "name", "label": "Name", "width": 22 },
                      { "key": "dmg", "label": "Dmg", "width": 8 },
                      { "key": "h", "label": "H", "width": 4 },
                      { "key": "reach", "label": "Reach", "width": 8 },
                      { "key": "enc", "label": "ENC", "width": 6 }
                    ],
                    "row_editor": { "buttons": ["add", "update", "delete"] }
                  },
                  {
                    "type": "table",
                    "id": "ranged_weapons",
                    "title": "Ranged Weapons",
                    "bind": "$.ranged_weapons",
                    "columns": [
                      { "key": "name", "label": "Name", "width": 22 },
                      { "key": "dmg", "label": "Dmg", "width": 8 },
                      { "key": "h", "label": "H", "width": 4 },
                      { "key": "reach", "label": "Reach", "width": 8 },
                      { "key": "enc", "label": "ENC", "width": 6 }
                    ],
                    "row_editor": { "buttons": ["add", "update", "delete"] }
                  }
                ]
              }
            ]
          },
          {
            "id": "tab_gear",
            "title": "Gear",
            "sections": [
              {
                "id": "talents_traits_powers",
                "title": "Talents, Traits, & Powers (Effects/Notes)",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  { "type": "field", "label": "Notes", "bind": "$.talents_traits_powers", "widget": "textarea", "height": 7 }
                ]
              },
              {
                "id": "items_equipment",
                "title": "Items & Equipment",
                "layout": { "type": "grid", "columns": 2 },
                "widgets": [
                  {
                    "type": "table",
                    "id": "items_table",
                    "bind": "$.items_equipment",
                    "columns": [
                      { "key": "item", "label": "Item", "width": 36 },
                      { "key": "enc", "label": "ENC", "width": 6 }
                    ],
                    "row_editor": { "buttons": ["add", "update", "delete"] }
                  },
                  {
                    "type": "group",
                    "id": "enc_money",
                    "title": "Totals",
                    "layout": { "type": "grid", "columns": 2 },
                    "widgets": [
                      { "type": "field", "label": "Total ENC", "bind": "$.total_enc", "widget": "spin_int", "min": 0, "max": 999 },
                      { "type": "field", "label": "Drakes", "bind": "$.drakes", "widget": "spin_int", "min": 0, "max": 999999 }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "id": "tab_magic",
            "title": "Magic",
            "sections": [
              {
                "id": "rituals",
                "title": "Rituals",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  { "type": "field", "label": "Rituals", "bind": "$.rituals", "widget": "textarea", "height": 4 }
                ]
              },
              {
                "id": "magic_skills",
                "title": "Skills (Magic)",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  {
                    "type": "table",
                    "id": "magic_skills_table",
                    "bind": "$.magic_skills",
                    "style": "skill",
                    "columns": [
                      { "key": "name", "label": "Skill", "width": 22 },
                      { "key": "rank", "label": "Rank", "width": 12 },
                      { "key": "bonus", "label": "Bonus", "width": 8 },
                      { "key": "tn", "label": "TN", "width": 8 }
                    ],
                    "defaults": [
                      { "name": "Alteration (Wp)", "rank": "", "bonus": 0, "tn": 0 },
                      { "name": "Conjuration (Wp)", "rank": "", "bonus": 0, "tn": 0 },
                      { "name": "Destruction (Wp)", "rank": "", "bonus": 0, "tn": 0 },
                      { "name": "Illusion (Wp)", "rank": "", "bonus": 0, "tn": 0 },
                      { "name": "Mysticism (Wp)", "rank": "", "bonus": 0, "tn": 0 },
                      { "name": "Necromancy (Int)", "rank": "", "bonus": 0, "tn": 0 },
                      { "name": "Restoration (Wp)", "rank": "", "bonus": 0, "tn": 0 }
                    ]
                  },
                  { "type": "field", "label": "Spellcasting", "bind": "$.spellcasting", "widget": "textarea", "height": 3 }
                ]
              },
              {
                "id": "spells",
                "title": "Spells",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  {
                    "type": "table",
                    "id": "spells_table",
                    "bind": "$.spells",
                    "columns": [
                      { "key": "level", "label": "Level", "width": 6 },
                      { "key": "cost", "label": "Cost", "width": 6 },
                      { "key": "spell_str", "label": "Spell Str.", "width": 10 },
                      { "key": "name_attr", "label": "Name: Attr.", "width": 24 },
                      { "key": "description", "label": "Description", "width": 40 }
                    ],
                    "row_editor": { "buttons": ["add", "update", "delete"] }
                  }
                ]
              }
            ]
          },
          {
            "id": "tab_notes",
            "title": "Notes",
            "sections": [
              {
                "id": "languages_bonds_block",
                "title": "Languages & Bonds",
                "layout": { "type": "grid", "columns": 2 },
                "widgets": [
                  { "type": "field", "label": "Languages", "bind": "$.languages", "widget": "tags", "hint": "comma-separated", "colspan": 1 },
                  { "type": "field", "label": "Bonds", "bind": "$.bonds", "widget": "tags", "hint": "comma-separated", "colspan": 1 }
                ]
              },
              {
                "id": "wounds_conditions",
                "title": "Wounds & Conditions",
                "layout": { "type": "grid", "columns": 2 },
                "widgets": [
                  { "type": "field", "label": "Wounds", "bind": "$.wounds", "widget": "textarea", "height": 5, "colspan": 1 },
                  { "type": "field", "label": "Conditions", "bind": "$.conditions", "widget": "textarea", "height": 5, "colspan": 1 }
                ]
              },
              {
                "id": "professions_custom_skills",
                "title": "Professions & Custom Skills",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  { "type": "field", "label": "Professions / Custom Skills", "bind": "$.professions_custom_skills", "widget": "textarea", "height": 5 }
                ]
              },
              {
                "id": "specializations",
                "title": "Specializations",
                "layout": { "type": "grid", "columns": 1 },
                "widgets": [
                  { "type": "field", "label": "Specializations", "bind": "$.specializations", "widget": "textarea", "height": 5 }
                ]
              }
            ]
          }
        ]
      }
    },
    {
      "id": "import_window",
      "type": "dialog",
      "title": "Import Character Data",
      "layout": { "type": "grid", "columns": 2 },
      "widgets": [
        { "type": "button", "text": "Choose JSON…", "command": "import_choose_json", "colspan": 2 },
        { "type": "field", "label": "Selected file", "bind": "$dialog.selected_path", "widget": "readonly_entry", "colspan": 2 },
        { "type": "preview", "id": "import_preview", "bind": "$dialog.preview", "height": 10, "colspan": 2 },
        { "type": "field", "label": "Overwrite existing fields", "bind": "$dialog.overwrite", "widget": "check", "colspan": 2 },
        { "type": "button", "text": "Import", "command": "import_apply", "colspan": 1 },
        { "type": "button", "text": "Cancel", "command": "dialog_close", "colspan": 1 }
      ],
      "import_map": {
        "name": "$.name",
        "race": "$.race",
        "concept": "$.concept",
        "favored_characteristics": "$.favored_characteristics",
        "birthsign": "$.birthsign",
        "characteristics": "$.characteristics",
        "derived_stats": "$.derived_stats",
        "luck_numbers": "$.luck_numbers",
        "skills": "$.skills"
      }
    }
  ]
}
